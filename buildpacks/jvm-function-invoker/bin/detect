#!/usr/bin/env bash

# shellcheck disable=SC2034
app_dir="$(pwd)"
# shellcheck disable=SC2034
platform_dir="${1:?}"
# shellcheck disable=SC2034
build_plan="${2:?}"

# shellcheck disable=SC2164
bpDir="$(
	cd "$(dirname "$0")/.."
	pwd
)" # absolute path

# shellcheck source=SCRIPTDIR/../lib/toolbox.sh
source "${bpDir}/lib/toolbox.sh"

install_toolbox "/tmp/utils"
PATH="/tmp/utils/bin:$PATH"

# We check for a project.toml/function.toml to be able to distinguish between regular JVM applications and a function.
# Just from the application alone, they're indistinguishable by design.
if [[ -f "${app_dir}/function.toml" || (-f "${app_dir}/project.toml" && $(yj -t <"${app_dir}/project.toml" | jq -r .com.salesforce.type) == "function") ]]; then
	cat >"${build_plan}" <<-EOF
		[[requires]]
		name = "jdk"

		[[requires]]
		name = "jvm-application"
	EOF

	exit 0
fi

exit 100
